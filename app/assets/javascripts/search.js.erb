function getFrameID(id){
    var elem = document.getElementById(id);
    if (elem) {
        if(/^iframe$/i.test(elem.tagName)) return id; //Frame, OK
        // else: Look for frame
        var elems = elem.getElementsByTagName("iframe");
        if (!elems.length) return null; //No iframe found, FAILURE
        for (var i=0; i<elems.length; i++) {
           if (/^https?:\/\/(?:www\.)?youtube(?:-nocookie)?\.com(\/|$)/i.test(elems[i].src)) break;
        }
        elem = elems[i]; //The only, or the best iFrame
        if (elem.id) return elem.id; //Existing ID, return it
        // else: Create a new ID
        do { //Keep postfixing `-frame` until the ID is unique
            id += "-frame";
        } while (document.getElementById(id));
        elem.id = id;
        return id;
    }
    // If no element, return null.
    return null;
}

// Define YT_ready function.
var YT_ready = (function() {
    var onReady_funcs = [], api_isReady = false;
    /* @param func function     Function to execute on ready
     * @param func Boolean      If true, all qeued functions are executed
     * @param b_before Boolean  If true, the func will added to the first
                                 position in the queue*/
    return function(func, b_before) {
        if (func === true) {
            api_isReady = true;
            while (onReady_funcs.length) {
                // Removes the first func from the array, and execute func
                onReady_funcs.shift()();
            }
        } else if (typeof func == "function") {
            if (api_isReady) func();
            else onReady_funcs[b_before?"unshift":"push"](func); 
        }
    }
})();
// This function will be called when the API is fully loaded
function onYouTubeIframeAPIReady() {YT_ready(true)}

// Load YouTube Frame API
(function() { // Closure, to not leak to the scope
  var s = document.createElement("script");
  s.src = (location.protocol == 'https:' ? 'https' : 'http') + "://www.youtube.com/iframe_api";
  var before = document.getElementsByTagName("script")[0];
  before.parentNode.insertBefore(s, before);
})();
var player; 
YT_ready(function(){
    var frameID = getFrameID("player");
    if (frameID) { //If the frame exists
        player = new YT.Player(frameID, {
            events: {
              'onReady': onPlayerReady,
              'onStateChange': stopCycle
            }
        });
    }
});

 var playerReady = false;
        function onPlayerReady(event) {
            playerReady = true;
        }

function stopCycle(event) {
          if (event.data == YT.PlayerState.ENDED) {
               var url = event.target.getVideoUrl();
               var match = url.match(/[?&]v=([^&]+)/);
               var videoId = match[1];
               $('#stopID').html(videoId);
               
                if($('#stopID').html() == videoID){
                  var thisVideo = $('#Playlist').find('li img[src="https://img.youtube.com/vi/'+videoID+'/mqdefault.jpg"]');
                  nextVideo = $(thisVideo).parent().next().find('.playlistYT');
                  nextVideo.click();
                }
               

          }

          else if (event.data == YT.PlayerState.PAUSED) {
            
            $('.glyphicon-pause').parent().css('display', 'none');
            $('.glyphicon-play').parent().css('display', 'inline-block');
          }

          else if (event.data == YT.PlayerState.PLAYING) {
            
            $('.glyphicon-play').parent().css('display', 'none');
            $('.glyphicon-pause').parent().css('display', 'inline-block');
          }
      }

function ytSearch()
        {
            var userSearch = document.getElementById('search_query').value;
            var songSearch = document.getElementById('song_query').value;    
            var script = document.createElement('script');
            script.setAttribute('id', 'jsonScript');
            script.setAttribute('type', 'text/javascript');
            if (songSearch.length == 0) {
                script.setAttribute('src', 'https://gdata.youtube.com/feeds/api/videos?category=Music&q='
              + userSearch + ' ' + '&type=video&start-index='+Math.round(Math.random()*100+1) +'&max-results=50&' + 
                   'alt=json-in-script&callback=showMyVideos&' + 
                   'orderby=relevance&sortorder=descending&format=5');
            }
            else {
                script.setAttribute('src', 'https://gdata.youtube.com/feeds/api/videos?category=Music&q='
              + userSearch.replace(/'/g, " ") + songSearch.replace(/'/g, " ") + '  ' + '&type=video&start-index=1&max-results=50&' + 
                   'alt=json-in-script&callback=showMyVideos&' + 
                   'orderby=relevance&sortorder=descending&format=5');
            };
            
            document.documentElement.firstChild.appendChild(script);
        }

        

            




        

$(function(){
    $('#Welcome').hide().fadeIn(3000);
});

function abracadabra() {
    
    $("#merchNgigs").fadeIn().css("display","inline-block");    

    
}


function profile() {
  $.get('/profile', function(result){
  $('#box2').html(result);});
  

    $('#container').animate({
        left: '0%',
        top: '-100%'
    });
}


function home(){
    $('#container').animate({
        left: '100%',
        top: '56px'
    });
}


$(function(){
  $('#Playlist').on('click', '.glyphicon-remove', function(){$(this).parent().parent().remove();});
  $("#Playlist").sortable({
      helper : 'clone',
    receive:function(event, ui) {
      transferred = true;
      





    }});




    





});